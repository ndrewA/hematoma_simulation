  ---
  Spec Review: Can You Build From This?

  Short answer: Yes, but the spec has a split personality. The solver/GPU side is near production-quality. The physics side has real gaps that will block you if you don't resolve them first. And there are
  concrete errors that need fixing.

  ---
  I. Concrete Errors (bugs in the spec)

  1. Path A/B/C naming is inconsistent and self-contradictory

  The spec defines Path names differently in two places and gets them wrong in a third:

  V Cycle Spec (Section 3):
  - Path A = Matrix-Free Diagonal (Lightweight)
  - Path B = Geometric Multigrid (Robust)
  - Path C = Residual (Precise)

  Voxel System Spec (Section 3.2, line 654-665):
  - Path A = Cascaded Geometric Multigrid
  - Path B = Matrix-Free Transient Precision (Residual)

  These are swapped. The Multigrid preconditioner is called Path A in one place and Path B in another.

  And then line 95 says: "If the residual fails to decrease efficiently while using Path B (Diagonal)..." — but Path B was just defined as the Multigrid, not the Diagonal. This sentence has Path A and B
  reversed.

  This needs a single consistent naming convention throughout.

  2. L2 resolution stated as 256^3 in the prose but 128^3 in the table

  Line 24 (the level table): L2 = 128^3.
  Line 75 (Section 3.2): "The Firewall (L2): The dense operator at Level 2 (256^3)" — says 256^3.
  Line 471 confirms L2 = 128^3: "At L2 (128^3), a single grid line contains 128 voxels."

  Line 75 is wrong. Should read 128^3.

  3. P2G shared memory tile dimensions don't match block size

  Section 2.1 of the pipeline spec (line 1196): "physically allocated with X-axis padding to create an odd-numbered stride (e.g., 7×6×6)"

  But L0 blocks are 8^3 voxels, and quadratic B-splines have 3-node support per axis. A particle at the edge of a block scatters to nodes in the neighboring block. The shared memory tile needs to cover at least
  the block (8) plus halo (1-2 on each side), giving something like 10×10×10 or 12×10×10 — not 7×6×6. The example dimensions seem wrong, or refer to something different than what the text implies.

  4. The LUT "dynamic scaling" is redundant

  Section 3.1 (line 643-646) describes the LUT being "dynamically scaled" by regime, but then all three regimes say K_LUT = K_phys. The scaling description is dead text — no regime actually modifies the
  permeability. Either remove it, or there used to be scaling in an earlier draft that was removed without cleaning up the framing.

  ---
  II. Physics Gaps (will block simulation)

  5. Anisotropic permeability tensor vs. scalar LUT — unresolved

  This is the most consequential physics gap. The math spec defines permeability as a tensor:

  $$\mathbf{K}{tissue} = k{iso}\mathbf{I} + k_{fiber}\mathbf{M}_0$$

  But the solver spec describes the permeability as a scalar retrieved from a LUT via the u8 index:

  "The kernel reads the u8 material index and retrieves the physical permeability K directly from the Global LUT"

  The transmissibility at a face is the harmonic mean of the scalar K of the two adjacent nodes. But if K is a tensor, the transmissibility in a given direction depends on the tensor projected along the face
  normal:

  $$K_{face} = \mathbf{n} \cdot \mathbf{K} \cdot \mathbf{n}$$

  The spec never describes:
  - How the tensor is reduced to a scalar per face
  - Whether M_0 is used in the transmissibility calculation or only in the constitutive model
  - Whether the residual kernel (which claims matrix-free reconstruction from u8 indices) also uses M_0

  If M_0 only affects the constitutive stress (elasticity) and not the permeability, then the diffusion is isotropic, which contradicts the math spec's tensor equation. If M_0 does affect permeability, the
  solver needs to read M_0 from grid memory during the residual calculation, which the spec doesn't describe.

  This needs a clear decision: is fluid diffusion anisotropic or isotropic in practice? If anisotropic, the entire solver stencil description needs updating.

  6. Regime I → II transition is never defined

  Regime II → III is explicitly defined (max unbalanced force < ε for 100+ frames). The wake-up from III → I is defined (external event detected). But I → II has no trigger condition.

  The spec gives time ranges ("0-1s" for I, "1s-3h" for II), but is the transition clock-based? Energy-based? Automatic? Manual? If it's a hard 1-second clock, that's fine but should be stated. If it's meant to
  be physical (e.g., "when kinetic energy drops below threshold"), the criterion needs defining.

  7. Hemorrhage source initiation is completely absent

  The spec describes damage → liquefaction → bleeding mechanics in detail, and passive tracer advection, and clot formation. But it never defines how the hemorrhage starts:

  - Is there an initial region of D=1 tissue?
  - Is there a point source injecting fluid particles at a fixed rate?
  - Does an impact (Regime I) create the initial damage dynamically?
  - How is the bleed location specified?

  You can build the entire solver and constitutive model, but you can't run a hematoma simulation without knowing how the hematoma is initiated. This is a gap in the spec, not just a preprocessing gap.

  8. No material property table

  The spec references material constants throughout but never provides actual values for anything except a few examples:

  ┌──────────────────────────────────────┬─────────────────────────────────┐
  │              Parameter               │             Status              │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ Permeability values per tissue class │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ σ_0 (yield stress)                   │ Given: ~1kPa brain, ~80MPa bone │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ Cowper-Symonds C, P                  │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ K_bulk (bulk modulus)                │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ μ (shear modulus)                    │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ k_1, k_2 (HGO fiber parameters)      │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ ρ_s, ρ_f (densities)                 │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ η_fluid, η_gel (viscosities)         │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ T_clot (coagulation time)            │ Given: ~6 hours                 │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ σ_contract (retraction pressure)     │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ η_visc (damage viscosity)            │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ κ (fiber dispersion)                 │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ K_p, K_d (volume controller gains)   │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ δ_max (slew rate limit)              │ Given: ~50 Pa                   │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ ε_tol (convergence tolerance)        │ Missing                         │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ N_cap (particles per block)          │ Given: ~512                     │
  ├──────────────────────────────────────┼─────────────────────────────────┤
  │ Δx (grid spacing)                    │ Missing                         │
  └──────────────────────────────────────┴─────────────────────────────────┘

  These are all needed to run. Many can come from literature, but they should be in the spec as a reference table.

  ---
  III. Architectural Concerns (won't block you immediately, but worth understanding)

  9. Operator splitting is single-pass, not iterative

  The Regime II Fixed-Stress Split does: one fluid macro-step → solid relaxation to equilibrium. In a proper iterative coupling, you'd alternate fluid/solid until the coupled system converges. The spec's
  single-pass approach is first-order in the coupling strength. For soft brain tissue with moderate compressibility, this is likely acceptable, but:
  - There's no convergence check on the coupled system
  - If the fluid pressure causes large deformation, the pressure computed with the "fixed skeleton" assumption may be significantly wrong
  - The spec acknowledges this implicitly (the RSGM watchdog monitors convergence) but never discusses the splitting error itself

  10. Particle overflow handling is undefined

  Section 1.5: "excess particles are shunted to a global overflow buffer to prevent data corruption, where they are processed by a fallback safety kernel." This fallback kernel is never described. During an
  expanding hematoma, particle density in the damage zone could easily exceed N_cap.

  11. Sub-cycling ratio is undefined

  "Regime II: High Ratio (e.g., 10:1)" — but is this adaptive? Fixed? The solid relaxation loop runs "until equilibrium," so it's implicitly variable, but the nominal N_sub is never defined for Regime I (where
  it presumably matters for CFL stability).

  12. Memory budget is never discussed

  Rough estimate for a ~15% occupied 512^3 domain at ~0.4mm spacing:
  - Grid state (all tiers): ~1-2 GB
  - Particles at 2 per cell: ~20M particles × ~120 bytes = ~2.4 GB
  - Dense levels (L2-L6): ~100 MB
  - Double-buffered particles: double the particle memory
  - Total: ~6-8 GB minimum

  This is feasible on a modern GPU (16-24 GB), but tight. At 4 particles per cell it doubles. The spec should at least acknowledge the budget.

  ---
  IV. What's Genuinely Strong

  To be fair, the good parts are very good:

  - The precision architecture (Tri-Path, Double-Single emulation, cascaded firewall) is deeply considered and addresses a real numerical problem. The hydraulic tunneling failure mode is well-understood and the
  mitigation is correct.
  - The RSGM protocol (spectral monitoring + reactive rebuild) is sophisticated. Amortizing operator construction based on actual convergence quality rather than geometric heuristics is smart.
  - The operator-induced prolongation with the physical throttle at L2→L3 is the right approach for high-contrast multigrid. This prevents the correction bleeding problem that would destroy physics at material
  interfaces.
  - The chrono-rheological model (damage → liquefaction → clotting → retraction) captures the clinical evolution of hematomas over hours/days. This is the kind of multi-physics coupling that makes the simulation
   scientifically interesting.
  - The GPU optimization strategies show real knowledge of GPU memory hierarchy. The pencil-staged ADLR, bank-aware padding, and coalesced bridge kernels are all standard high-performance computing techniques
  applied correctly.
  - The topological isolation via the tri-state material system (Active/Air/Vacuum) is clean. The branchless inner loops with arithmetic masking are well-motivated.
  - The particle-carried warm start is elegant — piggybacking the pressure solution on Lagrangian particles naturally handles topology changes.

  ---
  V. Verdict

  Can you start building from this spec? Yes, with caveats.

  The spec is strong enough to implement the solver core (multigrid hierarchy, V-cycle, PCG loop, sparse/dense bridge kernels, ADLR). These sections are detailed to the point of being nearly pseudocode.

  What will block you:
  1. Fix the naming inconsistencies (Paths, L2 resolution) before they cause confusion during implementation
  2. Resolve the anisotropic permeability question — this affects the fundamental stencil design
  3. Define the material property table and permeability LUT values
  4. Define the hemorrhage source mechanism
  5. Define the Regime I→II transition
  6. Define Δx

  Items 1-3 affect the solver stencil itself. Items 4-6 affect the simulation pipeline but not the core numerics. If you're starting with preprocessing, you can defer 4-6, but you need to resolve the anisotropy
  question (5) before designing the material map, since it determines whether distinct u8 indices for "WM along-fiber" vs "WM across-fiber" make sense or whether anisotropy is handled entirely through M_0.

  Want me to fix the concrete errors in the spec now, or would you prefer to work through the design decisions first?
